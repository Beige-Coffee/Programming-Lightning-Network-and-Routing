# Encrypted + Authenticated Communication

Great, now that we've built our intuition around why the Lightning Network developers chose to *not* to use TLS, it's time to introduce the chosen solution, **The Noise Protocol**. 

<p align="center" style="width: 50%; max-width: 300px;">
  <img src="./tutorial_images/alice_bob_noise.png" alt="alice_bob_noise" width="100%" height="auto">
</p>

## Noise Protocol Framework

The Noise Protocol is a **secure channel** protocol, meaning that data transmitted over this channel is resistant to outsiders eavesdropping and tampering with the content being transferred. If we were to map this definition onto Lightning, it means that, if Alice and Bob are communicating with each other, nobody else should be able to read the content of their messages or change the content itself. It's easy to see why this is crucial for a payment protocol. First, payments are private information and nobody else's business! Second, if anyone could alter data messages in transit, they could easily change the amount of money being sent in any given transaction. That would be... bad!

It's also worth noting that Lightning is in good company when it comes to choosing the Noise Protocol. For instance, popular messaging platforms such as WhatsApp and Slack also leverage the Noise Framework to add end-to-end encryption for their 3+ billion users!

Up next, we'll dig very deep into the Noise Protocol and even implement part of it ourselves! However, before doing that, let's introduce a few important security properties that the Noise Protocol will provide for Lightning. By starting with the larger picture, it will help put everything in the proper context when we begin digging into the details.

### Mutual Authentication (& Identity Hiding)
In any secure communication channel, it's vital that participants are able to **authenticate** each other, ensuring they are truly communicating with who they think they are. The Noise Protocol makes this possible through an initial **handshake** process, whereby Alice and Bob will prove to each other that they possess the private key to their public key identity - authenticating themselves to each other.

Furthermore, Lightning's handshake pattern (Noise_XK) is designed such that the initiator must already know the responders public key identity. However, they will never transmit the responder's public key over the wire. Instead, they will perform a few cryptographic operations such that only the initiator and responder can verify each other's identity implicitly using data transmitted. This enables **identity hiding** - meaning that eavesdroppers cannot easily identify which nodes are communicating with each other.

<p align="center" style="width: 50%; max-width: 300px;">
  <img src="./tutorial_images/identity_hiding.png" alt="identity_hiding" width="60%" height="auto">
</p>

### Encryption & Message Integrity
Next up, our secure communication channel will need to support encryption and message integrity, providing two critical guarantees:

**Confidentiality**: All communication sent between nodes must be encrypted such that only the intended recipient can decrypt and read the message contents.

**Authentication**: Encrypting messages is important, but it's not enough by itself! Additionally, all encrypted communication must include an *authentication tag*, which acts as a unique identifier to the message content. If the message content is changed in any way, the tag itself will change. This ensures that, if an attacker were to alter an encrypted message, the authentication tag would fail and the recipient would know the message has been tampered with.

<p align="center" style="width: 50%; max-width: 300px;">
  <img src="./tutorial_images/encryption.png" alt="encryption" width="60%" height="auto">
</p>

### Forward Secrecy
Imagine a "hyperbitcoinized" future, where lightning nodes have been running for many years at a time. These nodes will have undoubtedly exchanged many messages about private payments - a honeypot for an attacker looking to mine sensitive data. If a bad actor were to obtain the private key used to encrypt messages, they'd have a treasure trove of data!

To mitigate against this sort of data breach, the Noise Protocol provides **forward secrecy**, whereby both Alice and Bob will derive a shared secret using ephemeral keys which are deleted after the handshake phase. This ensures that, even if Alice and Bob both leak their Lightning Node private keys, their channel communication will stay encrypted. Furthermore, leveraging a technique called "key rotation", Alice and Bob will change their encryption keys roughly every 500 Lightning messages, ensuring that ongoing communication is safe in case the encryption keys themselves are leaked. Once the new key is derived, the old key is discarded and cannot be recovered.


<p align="center" style="width: 50%; max-width: 300px;">
  <img src="./tutorial_images/forward_secrecy.png" alt="forward_secrecy" width="60%" height="auto">
</p>

